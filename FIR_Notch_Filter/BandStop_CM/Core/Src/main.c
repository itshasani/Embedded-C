/* USER CODE BEGIN Header */
/**
  ******************************************************************************
  * @file           : main.c
  * @brief          : Main program body
  ******************************************************************************
  * @attention
  *
  * Copyright (c) 2024 STMicroelectronics.
  * All rights reserved.
  *
  * This software is licensed under terms that can be found in the LICENSE file
  * in the root directory of this software component.
  * If no LICENSE file comes with this software, it is provided AS-IS.
  *
  ******************************************************************************
  */
/* USER CODE END Header */
/* Includes ------------------------------------------------------------------*/
#include "main.h"

/* Private includes ----------------------------------------------------------*/
/* USER CODE BEGIN Includes */
#include <string.h>
#define ARM_MATH_CM4
#include "arm_math.h"
/* USER CODE END Includes */

/* Private typedef -----------------------------------------------------------*/
/* USER CODE BEGIN PTD */

/* USER CODE END PTD */

/* Private define ------------------------------------------------------------*/
/* USER CODE BEGIN PD */

/* USER CODE END PD */

/* Private macro -------------------------------------------------------------*/
/* USER CODE BEGIN PM */

/* USER CODE END PM */

/* Private variables ---------------------------------------------------------*/
TIM_HandleTypeDef htim5;

UART_HandleTypeDef huart2;

/* USER CODE BEGIN PV */
uint16_t sampleIn, sampleOut, sampleOld;
float dataIn;
uint8_t state , trigData;
float dataOut, dataInArray[5030] , dataOutArray[5030];

uint32_t usRefCnt[5027] , usCnt[5027];

float timeA;

float32_t filter_v4coeff_ASN[65] = {
		0.08958515735,-0.35641307302, -0.08816439163, -0.01673164760
		,  0.00267671775,  0.00084990737, -0.00631196308, -0.00603705704,
		  0.00207753587,  0.00743013163,  0.00284795312
		, -0.00564425406, -0.00662824652,  0.00129517476
		,  0.00747909952, 0.00392119045
		, -0.00521757386, -0.00688232905,  0.00007347480,  0.00763708999
		,  0.00488166687, -0.00444294017, -0.00755898860, -0.00049117998
		,  0.00729939486,  0.00547822890, -0.00355743075, -0.00784931271, -0.00185963258
		,  0.00646202821, 0.00616345406, -0.00258174936,  0.99254268155
		, -0.00258174936,  0.00616345406,  0.00646202821, -0.00185963258, -0.00784931271
		, -0.00355743075,  0.00547822890
		, 0.00729939486, -0.00049117998, -0.00755898860, -0.00444294017
		,  0.00488166687,  0.00763708999,  0.00007347480, -0.00688232905
		, -0.00521757386,  0.00392119045,  0.00747909952,  0.00129517476
		, -0.00662824652, -0.00564425406,  0.00284795312,  0.00743013163
		,  0.00207753587, -0.00603705704, -0.00631196308,  0.00084990737
		,  0.00267671775,-0.01673164760, -0.08816439163, -0.35641307302
		,  0.08958515735
};
float32_t real64_TB[486] = {
  -0.000952060804133, -0.00511850896509, 0.001076579968211,-0.0009265011144901,
  -0.0004804320994588,0.0003492303232949,0.0007332388711938,0.0001538093143762,
  -0.0006066743612229,-0.0005652402729948,0.0002105236464822,0.0007058189794176,
  0.0002767288432712,-0.0005177414400511,-0.0006390316812398,8.159934308783e-05,
  0.0007090748155551,0.0004119062385891,-0.000441586270555,-0.000734935094105,
  -5.850024396292e-05,0.0007222155478827, 0.000569164725518,-0.0003524137500009,
  -0.0008430933779919,-0.0002258351283765,0.0007236794983633,0.0007475391326169,
  -0.0002311017087815,-0.0009475355908719,-0.0004265108314865,0.0006931949031117,
  0.0009369136832169,-6.575574196284e-05,-0.001028828168752,-0.0006570758094133,
  0.0006143193535995, 0.001121195841442,  0.00014760392047,-0.001068188256649,
  -0.0009065263663965,0.0004766968505132, 0.001280753231922,0.0004042753874883,
  -0.001048833055397, -0.00115739600063,0.0002765629170224, 0.001395096968233,
  0.0006920640859793,-0.000959243321731,-0.001388072062838,1.877623895395e-05,
   0.001445555402925,0.0009919009541442,-0.0007947975402793,-0.001575398381825,
  -0.0002838456439298,  0.00141805125224,   0.0012800179686,-0.0005589202618465,
  -0.001697720960214,-0.0006114247867149, 0.001305512649333, 0.001530262471727,
  -0.0002642507031718,-0.001737522154988,-0.0009377037370371,  0.00110958465885,
   0.001717395961496,6.871154837627e-05,-0.001684254116639,-0.001233351451742,
  0.0008421020379415, 0.001820750297163,0.0004131365174125,-0.001535821076633,
  -0.001468779834916,0.0005228240077164, 0.001823139336034,0.0007332415350602,
   -0.00130554155803,-0.001621520413306,0.0001787726248305, 0.001720645156055,
  0.0009998416677441,-0.001006892906117,-0.001665495888104,-0.0001494387517857,
     0.0015222745796, 0.001177637601285,-0.0006765188035466,-0.001594996862144,
  -0.0004288498523927, 0.001241983729015, 0.001249501060368,-0.0003467191093262,
  -0.001415975640101,-0.0006185219712337,0.0009140364773944, 0.001189173649894,
  -6.402755810365e-05,-0.001135145146598,-0.0006912749578279,0.0005793030633666,
   0.000998388471474,0.0001326038170215,-0.0007927098983454,-0.000621425909588,
  0.0002816662169437,0.0006951288162447,0.0001998513578624,-0.0004263759793942,
  -0.0004030728413836, 7.29930881554e-05, 0.000303455300809,0.0001096050408713,
  -8.722453177393e-05,-4.19993496523e-05,-4.376397943994e-08,-0.0001340317413333,
  -0.0001553139041764,0.0001676338894565,0.0004366384915542,0.0001025725321271,
  -0.0005611749848924,-0.000594490294428,  0.00028120399988,0.0009893478777794,
  0.0004069603306234,-0.000913620722794,-0.001187140124983,0.0002025241847578,
   0.001557987175728,0.0009224605051733,-0.001125735745355,-0.001893858444671,
  -0.0001062886863086, 0.002073768291881, 0.001637176255972,-0.001135205521628,
  -0.002656824624339,-0.0006665899153086, 0.002461569718206, 0.002517320160926,
  -0.0008900832845521,-0.003403026078349,-0.001477949501832,  0.00264669729085,
   0.003507468903744,-0.0003545608868873,-0.004048922663008,-0.002515509072299,
   0.002562027769306, 0.004533469159748,0.0004866709074279,-0.004506755704743,
  -0.003729951153842, 0.002154064408579, 0.005504846850274, 0.001620662443539,
  -0.004694837483385,-0.005049564287168, 0.001390605914866, 0.006324520392883,
   0.003009882843547,-0.004540094611228,-0.006381198880224,0.0002664839895145,
   0.006894103654099, 0.004587474982994,-0.003991764268393,-0.007620410305946,
  -0.001194789830273, 0.007123796432969, 0.006264344331298,-0.003022545407196,
  -0.008655491746602,-0.002939518216394, 0.006938711203829, 0.007930946976372,
  -0.001636621240779,-0.009379430931297,-0.004884421574326, 0.006291478042539,
   0.009467146324391,0.0001284108726796,-0.009695658468387,-0.006923736527822,
   0.005159563272236,  0.01075181730248, 0.002204326988044,-0.009530569176842,
  -0.008932747051806, 0.003559288410141,  0.01166677993776, 0.004492573056272,
  -0.008837258731383, -0.01077731211168, 0.001539809867329,  0.01211338286083,
   0.006871377279746,-0.007604344969573, -0.01232530553712,-0.0008161424356647,
    0.01201955949276, 0.009201727564157,-0.005855727297851, -0.01345628889667,
  -0.003394510522945,  0.01134203084248,  0.01134044321177,-0.003653923162728,
   -0.01406801463572,-0.006060546273475,   0.0100769288745,  0.01314754749814,
  -0.001095799764423, -0.01408948187405,-0.008664259090735, 0.008259838696972,
    0.01449756785931, 0.001693715524322, -0.01348544955936,  -0.0110549861481,
   0.005964456833317,  0.01529133982218,  0.00456797512264, -0.01226038277599,
   -0.01308842983934, 0.003298103130484,  0.01546103548303, 0.007370606859408,
   -0.01045866373372, -0.01463886634236,0.0003966426783485,  0.01497847364878,
   0.009945469492706,-0.008164221572093, -0.01561024382555,-0.002587507843283,
    0.01385598045472,  0.01214792665285,-0.005493198621807,   0.9840592436903,
  -0.005493198621807,  0.01214792665285,  0.01385598045472,-0.002587507843283,
   -0.01561024382555,-0.008164221572093, 0.009945469492706,  0.01497847364878,
  0.0003966426783485, -0.01463886634236, -0.01045866373372, 0.007370606859408,
    0.01546103548303, 0.003298103130484, -0.01308842983934, -0.01226038277599,
    0.00456797512264,  0.01529133982218, 0.005964456833317,  -0.0110549861481,
   -0.01348544955936, 0.001693715524322,  0.01449756785931, 0.008259838696972,
  -0.008664259090735, -0.01408948187405,-0.001095799764423,  0.01314754749814,
     0.0100769288745,-0.006060546273475, -0.01406801463572,-0.003653923162728,
    0.01134044321177,  0.01134203084248,-0.003394510522945, -0.01345628889667,
  -0.005855727297851, 0.009201727564157,  0.01201955949276,-0.0008161424356647,
   -0.01232530553712,-0.007604344969573, 0.006871377279746,  0.01211338286083,
   0.001539809867329, -0.01077731211168,-0.008837258731383, 0.004492573056272,
    0.01166677993776, 0.003559288410141,-0.008932747051806,-0.009530569176842,
   0.002204326988044,  0.01075181730248, 0.005159563272236,-0.006923736527822,
  -0.009695658468387,0.0001284108726796, 0.009467146324391, 0.006291478042539,
  -0.004884421574326,-0.009379430931297,-0.001636621240779, 0.007930946976372,
   0.006938711203829,-0.002939518216394,-0.008655491746602,-0.003022545407196,
   0.006264344331298, 0.007123796432969,-0.001194789830273,-0.007620410305946,
  -0.003991764268393, 0.004587474982994, 0.006894103654099,0.0002664839895145,
  -0.006381198880224,-0.004540094611228, 0.003009882843547, 0.006324520392883,
   0.001390605914866,-0.005049564287168,-0.004694837483385, 0.001620662443539,
   0.005504846850274, 0.002154064408579,-0.003729951153842,-0.004506755704743,
  0.0004866709074279, 0.004533469159748, 0.002562027769306,-0.002515509072299,
  -0.004048922663008,-0.0003545608868873, 0.003507468903744,  0.00264669729085,
  -0.001477949501832,-0.003403026078349,-0.0008900832845521, 0.002517320160926,
   0.002461569718206,-0.0006665899153086,-0.002656824624339,-0.001135205521628,
   0.001637176255972, 0.002073768291881,-0.0001062886863086,-0.001893858444671,
  -0.001125735745355,0.0009224605051733, 0.001557987175728,0.0002025241847578,
  -0.001187140124983,-0.000913620722794,0.0004069603306234,0.0009893478777794,
    0.00028120399988,-0.000594490294428,-0.0005611749848924,0.0001025725321271,
  0.0004366384915542,0.0001676338894565,-0.0001553139041764,-0.0001340317413333,
  -4.376397943994e-08,-4.19993496523e-05,-8.722453177393e-05,0.0001096050408713,
   0.000303455300809, 7.29930881554e-05,-0.0004030728413836,-0.0004263759793942,
  0.0001998513578624,0.0006951288162447,0.0002816662169437,-0.000621425909588,
  -0.0007927098983454,0.0001326038170215, 0.000998388471474,0.0005793030633666,
  -0.0006912749578279,-0.001135145146598,-6.402755810365e-05, 0.001189173649894,
  0.0009140364773944,-0.0006185219712337,-0.001415975640101,-0.0003467191093262,
   0.001249501060368, 0.001241983729015,-0.0004288498523927,-0.001594996862144,
  -0.0006765188035466, 0.001177637601285,   0.0015222745796,-0.0001494387517857,
  -0.001665495888104,-0.001006892906117,0.0009998416677441, 0.001720645156055,
  0.0001787726248305,-0.001621520413306, -0.00130554155803,0.0007332415350602,
   0.001823139336034,0.0005228240077164,-0.001468779834916,-0.001535821076633,
  0.0004131365174125, 0.001820750297163,0.0008421020379415,-0.001233351451742,
  -0.001684254116639,6.871154837627e-05, 0.001717395961496,  0.00110958465885,
  -0.0009377037370371,-0.001737522154988,-0.0002642507031718, 0.001530262471727,
   0.001305512649333,-0.0006114247867149,-0.001697720960214,-0.0005589202618465,
     0.0012800179686,  0.00141805125224,-0.0002838456439298,-0.001575398381825,
  -0.0007947975402793,0.0009919009541442, 0.001445555402925,1.877623895395e-05,
  -0.001388072062838,-0.000959243321731,0.0006920640859793, 0.001395096968233,
  0.0002765629170224, -0.00115739600063,-0.001048833055397,0.0004042753874883,
   0.001280753231922,0.0004766968505132,-0.0009065263663965,-0.001068188256649,
    0.00014760392047, 0.001121195841442,0.0006143193535995,-0.0006570758094133,
  -0.001028828168752,-6.575574196284e-05,0.0009369136832169,0.0006931949031117,
  -0.0004265108314865,-0.0009475355908719,-0.0002311017087815,0.0007475391326169,
  0.0007236794983633,-0.0002258351283765,-0.0008430933779919,-0.0003524137500009,
   0.000569164725518,0.0007222155478827,-5.850024396292e-05,-0.000734935094105,
  -0.000441586270555,0.0004119062385891,0.0007090748155551,8.159934308783e-05,
  -0.0006390316812398,-0.0005177414400511,0.0002767288432712,0.0007058189794176,
  0.0002105236464822,-0.0005652402729948,-0.0006066743612229,0.0001538093143762,
  0.0007332388711938,0.0003492303232949,-0.0004804320994588,-0.0009265011144901,
   0.001076579968211, -0.00511850896509
};
float32_t FINAL[100] = {
		  -0.003257675184696, 0.008653369276161, 0.009529586358114,-0.002769580821533,
		   -0.01219544076738,-0.005434301972044, 0.009345626775536,  0.01225161588417,
		  -0.001560589533813, -0.01413014286101, -0.00803356270546, 0.009490465597452,
		    0.01500513722328,0.0002311821543768, -0.01567087098639, -0.01094052456451,
		   0.009007986549138,  0.01761507149285, 0.002558873682584, -0.01667429609067,
		   -0.01400303823924, 0.007864019643021,  0.01990240595492, 0.005326506006121,
		   -0.01702928243176, -0.01704302962025, 0.006075991127795,  0.02169991003323,
		   0.008394675918083, -0.01666851751209,  -0.0198708213216, 0.003714065368737,
		    0.02286739760722,  0.01159066693677, -0.01557641370943, -0.02230113344652,
		  0.0008972948355085,   0.0233049807716,  0.01472209000399, -0.01379237866336,
		   -0.02416920281646,  -0.0022149696433,  0.02296293550753,  0.01759277701828,
		   -0.01140901765165, -0.02534541528054,-0.005435655444123,  0.02184712746945,
		    0.02001939186898,-0.008565351961656,   0.9742530260181,-0.008565351961656,
		    0.02001939186898,  0.02184712746945,-0.005435655444123, -0.02534541528054,
		   -0.01140901765165,  0.01759277701828,  0.02296293550753,  -0.0022149696433,
		   -0.02416920281646, -0.01379237866336,  0.01472209000399,   0.0233049807716,
		  0.0008972948355085, -0.02230113344652, -0.01557641370943,  0.01159066693677,
		    0.02286739760722, 0.003714065368737,  -0.0198708213216, -0.01666851751209,
		   0.008394675918083,  0.02169991003323, 0.006075991127795, -0.01704302962025,
		   -0.01702928243176, 0.005326506006121,  0.01990240595492, 0.007864019643021,
		   -0.01400303823924, -0.01667429609067, 0.002558873682584,  0.01761507149285,
		   0.009007986549138, -0.01094052456451, -0.01567087098639,0.0002311821543768,
		    0.01500513722328, 0.009490465597452, -0.00803356270546, -0.01413014286101,
		  -0.001560589533813,  0.01225161588417, 0.009345626775536,-0.005434301972044,
		   -0.01219544076738,-0.002769580821533, 0.009529586358114, 0.008653369276161,
};



/* -------------------------------------------------------------------------------------------------*/



float32_t FIRstateF32[1024 + 1160 -1 ];
/* USER CODE END PV */

/* Private function prototypes -----------------------------------------------*/
void SystemClock_Config(void);
static void MX_GPIO_Init(void);
static void MX_USART2_UART_Init(void);
static void MX_TIM5_Init(void);
/* USER CODE BEGIN PFP */

/* USER CODE END PFP */

/* Private user code ---------------------------------------------------------*/
/* USER CODE BEGIN 0 */

/* USER CODE END 0 */

/**
  * @brief  The application entry point.
  * @retval int
  */
int main(void)
{

  /* USER CODE BEGIN 1 */

  /* USER CODE END 1 */

  /* MCU Configuration--------------------------------------------------------*/

  /* Reset of all peripherals, Initializes the Flash interface and the Systick. */
  HAL_Init();

  /* USER CODE BEGIN Init */

  /* USER CODE END Init */

  /* Configure the system clock */
  SystemClock_Config();

  /* USER CODE BEGIN SysInit */

  /* USER CODE END SysInit */

  /* Initialize all configured peripherals */
  MX_GPIO_Init();
  MX_USART2_UART_Init();
  MX_TIM5_Init();
  /* USER CODE BEGIN 2 */
/*
  int k;
  for(k=0;k < 1160;k++)
  {
	  if ((aFIR_F32_Coeffs[k] > 0) & (aFIR_F32_Coeffs[k] < 0.001))
	  {
		  aFIR_F32_Coeffs[k] =0;
	  }
	  if ((aFIR_F32_Coeffs[k] < 0) & (aFIR_F32_Coeffs[k] < -0.001))
	  {
		  aFIR_F32_Coeffs[k] =0;
	  }
  }
*/
  sampleOld = 0;
  sampleIn = 0;
  sampleOut = 1;
  dataIn = 0;
  dataOut = 0;
  timeA = 0;
  trigData = 0;
  memset(dataInArray,0,sizeof(dataInArray));
  memset(dataOutArray,0,sizeof(dataOutArray));

  memset(usRefCnt,0,sizeof(usRefCnt));
  memset(usCnt,0,sizeof(usCnt));
 // usRefCnt = 0;
 // usCnt = 0;

  /* USER CODE END 2 */

  /* Infinite loop */
  /* USER CODE BEGIN WHILE */
  while (1)
  {
    /* USER CODE END WHILE */

    /* USER CODE BEGIN 3 */
	  switch (state) {
			// copy each sample to input array
	  case 0:
		  	  if(sampleIn != sampleOld)
		  	  {
		  		  dataInArray[sampleIn - 1] = dataIn;
		  		  sampleOld ++;
		  	  }
		  	  if (sampleOld == 5026)
		  	  {
		  		 sampleOld = 0;
		  		 sampleOut = 1;
		  		 state =1 ;
		  	  }
			break;
	  case 1:
		  	  // copy data in array to data out array
		  int n;
		  int i;

		  for (n = 0;n < 5027;n++)
		  {
			  usRefCnt[n] = __HAL_TIM_GET_COUNTER(&htim5);
			  for (i=0 ; i < 65;i++)
			  {
				  if((n-i) < 0)
				  {
					  break;
				  }
				  else
				  {
				  dataOutArray[n] += filter_v4coeff_ASN[i]*dataInArray[n-i];
				  }
			  }
			  usCnt[n] =  __HAL_TIM_GET_COUNTER(&htim5) - usRefCnt[n];
		  }

		  state = 2;
		  break;
	  case 2:
		  	  // with some proper sampling time copy each output array to data out variable
		  dataOut = dataOutArray[sampleOut - 1];
		  HAL_Delay(25);
		  trigData = 1;
		  HAL_Delay(25);
		  trigData = 0;
		  timeA = usCnt[sampleOut -1];
		  sampleOut ++;
		  if(sampleOut == 5026)
		  {
			  sampleOut = 1;
			  state = 3;
		  }
		  break;
	  case 3 :
		  	 break;

	}
  }
  /* USER CODE END 3 */
}

/**
  * @brief System Clock Configuration
  * @retval None
  */
void SystemClock_Config(void)
{
  RCC_OscInitTypeDef RCC_OscInitStruct = {0};
  RCC_ClkInitTypeDef RCC_ClkInitStruct = {0};

  /** Configure the main internal regulator output voltage
  */
  __HAL_RCC_PWR_CLK_ENABLE();
  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);

  /** Initializes the RCC Oscillators according to the specified parameters
  * in the RCC_OscInitTypeDef structure.
  */
  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;
  RCC_OscInitStruct.HSIState = RCC_HSI_ON;
  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;
  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;
  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSI;
  RCC_OscInitStruct.PLL.PLLM = 8;
  RCC_OscInitStruct.PLL.PLLN = 180;
  RCC_OscInitStruct.PLL.PLLP = RCC_PLLP_DIV4;
  RCC_OscInitStruct.PLL.PLLQ = 2;
  RCC_OscInitStruct.PLL.PLLR = 2;
  if (HAL_RCC_OscConfig(&RCC_OscInitStruct) != HAL_OK)
  {
    Error_Handler();
  }

  /** Activate the Over-Drive mode
  */
  if (HAL_PWREx_EnableOverDrive() != HAL_OK)
  {
    Error_Handler();
  }

  /** Initializes the CPU, AHB and APB buses clocks
  */
  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK
                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;
  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLRCLK;
  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;
  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV4;
  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV2;

  if (HAL_RCC_ClockConfig(&RCC_ClkInitStruct, FLASH_LATENCY_5) != HAL_OK)
  {
    Error_Handler();
  }
}

/**
  * @brief TIM5 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM5_Init(void)
{

  /* USER CODE BEGIN TIM5_Init 0 */

  /* USER CODE END TIM5_Init 0 */

  TIM_ClockConfigTypeDef sClockSourceConfig = {0};
  TIM_MasterConfigTypeDef sMasterConfig = {0};

  /* USER CODE BEGIN TIM5_Init 1 */

  /* USER CODE END TIM5_Init 1 */
  htim5.Instance = TIM5;
  htim5.Init.Prescaler = 89;
  htim5.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim5.Init.Period = 4294967295;
  htim5.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim5.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_ENABLE;
  if (HAL_TIM_Base_Init(&htim5) != HAL_OK)
  {
    Error_Handler();
  }
  sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL;
  if (HAL_TIM_ConfigClockSource(&htim5, &sClockSourceConfig) != HAL_OK)
  {
    Error_Handler();
  }
  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim5, &sMasterConfig) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM5_Init 2 */
  HAL_TIM_Base_Start(&htim5);
  /* USER CODE END TIM5_Init 2 */

}

/**
  * @brief USART2 Initialization Function
  * @param None
  * @retval None
  */
static void MX_USART2_UART_Init(void)
{

  /* USER CODE BEGIN USART2_Init 0 */

  /* USER CODE END USART2_Init 0 */

  /* USER CODE BEGIN USART2_Init 1 */

  /* USER CODE END USART2_Init 1 */
  huart2.Instance = USART2;
  huart2.Init.BaudRate = 115200;
  huart2.Init.WordLength = UART_WORDLENGTH_8B;
  huart2.Init.StopBits = UART_STOPBITS_1;
  huart2.Init.Parity = UART_PARITY_NONE;
  huart2.Init.Mode = UART_MODE_TX_RX;
  huart2.Init.HwFlowCtl = UART_HWCONTROL_NONE;
  huart2.Init.OverSampling = UART_OVERSAMPLING_16;
  if (HAL_UART_Init(&huart2) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN USART2_Init 2 */

  /* USER CODE END USART2_Init 2 */

}

/**
  * @brief GPIO Initialization Function
  * @param None
  * @retval None
  */
static void MX_GPIO_Init(void)
{
  GPIO_InitTypeDef GPIO_InitStruct = {0};
/* USER CODE BEGIN MX_GPIO_Init_1 */
/* USER CODE END MX_GPIO_Init_1 */

  /* GPIO Ports Clock Enable */
  __HAL_RCC_GPIOC_CLK_ENABLE();
  __HAL_RCC_GPIOH_CLK_ENABLE();
  __HAL_RCC_GPIOA_CLK_ENABLE();
  __HAL_RCC_GPIOB_CLK_ENABLE();

  /*Configure GPIO pin Output Level */
  HAL_GPIO_WritePin(LD2_GPIO_Port, LD2_Pin, GPIO_PIN_RESET);

  /*Configure GPIO pin : B1_Pin */
  GPIO_InitStruct.Pin = B1_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_IT_FALLING;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  HAL_GPIO_Init(B1_GPIO_Port, &GPIO_InitStruct);

  /*Configure GPIO pin : LD2_Pin */
  GPIO_InitStruct.Pin = LD2_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(LD2_GPIO_Port, &GPIO_InitStruct);

/* USER CODE BEGIN MX_GPIO_Init_2 */
/* USER CODE END MX_GPIO_Init_2 */
}

/* USER CODE BEGIN 4 */

/* USER CODE END 4 */

/**
  * @brief  This function is executed in case of error occurrence.
  * @retval None
  */
void Error_Handler(void)
{
  /* USER CODE BEGIN Error_Handler_Debug */
  /* User can add his own implementation to report the HAL error return state */
  __disable_irq();
  while (1)
  {
  }
  /* USER CODE END Error_Handler_Debug */
}

#ifdef  USE_FULL_ASSERT
/**
  * @brief  Reports the name of the source file and the source line number
  *         where the assert_param error has occurred.
  * @param  file: pointer to the source file name
  * @param  line: assert_param error line source number
  * @retval None
  */
void assert_failed(uint8_t *file, uint32_t line)
{
  /* USER CODE BEGIN 6 */
  /* User can add his own implementation to report the file name and line number,
     ex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */
  /* USER CODE END 6 */
}
#endif /* USE_FULL_ASSERT */
